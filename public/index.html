<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EconoGraph - Economic Research Visualization</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;
    
    // Lucide icons as simple SVG components
    const FileText = ({ size = 24, style, className }) => (
      <svg width={size} height={size} style={style} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
    );
    
    const Database = ({ size = 24, style, className }) => (
      <svg width={size} height={size} style={style} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
      </svg>
    );
    
    const User = ({ size = 24, style, className }) => (
      <svg width={size} height={size} style={style} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
    );
    
    const Download = ({ size = 24, style, className }) => (
      <svg width={size} height={size} style={style} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );
    
    const Sparkles = ({ size = 24, style, className }) => (
      <svg width={size} height={size} style={style} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
        <path d="M5 3v4"></path>
        <path d="M19 17v4"></path>
        <path d="M3 5h4"></path>
        <path d="M17 19h4"></path>
      </svg>
    );
    
    const Upload = ({ size = 24, style, className }) => (
      <svg width={size} height={size} style={style} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
    );
    
    const Eye = ({ size = 24, style, className }) => (
      <svg width={size} height={size} style={style} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
    );

    // Check if we're on Netlify or local
    const IS_NETLIFY = window.location.hostname.includes('netlify.app');
    const API_ENDPOINT = IS_NETLIFY ? '/.netlify/functions/generate-visualization' : '/api/generate';
    const PDF_ENDPOINT = IS_NETLIFY ? '/.netlify/functions/extract-pdf' : '/api/extract-pdf';

    const EconoGraph = () => {
      const [activeTab, setActiveTab] = useState('home');
      const [profile, setProfile] = useState({
        name: 'Muad A. Almukhlef',
        department: 'International Economic Research Department',
        generalDepartment: 'Economic Research Department',
        institution: 'Saudi Central Bank'
      });
      const [textInput, setTextInput] = useState('');
      const [dataInput, setDataInput] = useState('');
      const [useOfficialBranding, setUseOfficialBranding] = useState(false);
      const [isGenerating, setIsGenerating] = useState(false);
      const [generatedContent, setGeneratedContent] = useState(null);
      const [uploadedFileName, setUploadedFileName] = useState('');
      const [isProcessingFile, setIsProcessingFile] = useState(false);
      const [userInstructions, setUserInstructions] = useState('');
      const [revisionInstructions, setRevisionInstructions] = useState('');

      const primaryGreen = '#006847';
      const lightGreen = '#e8f5f0';

      const handleFileUpload = async (event, mode) => {
        const file = event.target.files[0];
        if (!file) return;

        setIsProcessingFile(true);
        setUploadedFileName(file.name);

        try {
          const fileExtension = file.name.split('.').pop().toLowerCase();
          let extractedText = '';

          if (fileExtension === 'pdf') {
            const base64Data = await new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = () => {
                const base64 = reader.result.split(",")[1];
                resolve(base64);
              };
              reader.onerror = () => reject(new Error("Failed to read file"));
              reader.readAsDataURL(file);
            });

            const response = await fetch(PDF_ENDPOINT, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                base64Data: base64Data,
                text: "Please extract all the text content from this PDF document. Preserve the structure and formatting as much as possible, including headings, paragraphs, and key sections. Return only the extracted text without any additional commentary."
              })
            });

            const data = await response.json();
            extractedText = data.content[0].text;
            
          } else if (fileExtension === 'txt') {
            extractedText = await file.text();
          } else if (fileExtension === 'csv') {
            extractedText = await file.text();
          } else {
            alert('Unsupported file format. Please upload PDF, TXT, or CSV files.');
            setIsProcessingFile(false);
            return;
          }

          if (mode === 'text') {
            setTextInput(extractedText);
          } else {
            setDataInput(extractedText);
          }
        } catch (error) {
          console.error('Error processing file:', error);
          alert('Error reading file. Please try again or paste the content manually.');
        } finally {
          setIsProcessingFile(false);
        }
      };

      const handleGenerateVisualization = async (isRevision = false) => {
        setIsGenerating(true);
        
        try {
          const mode = activeTab === 'text' ? 'text' : 'data';
          const content = mode === 'text' ? textInput : dataInput;
          
          let prompt = '';
          
          if (mode === 'text') {
            if (isRevision && generatedContent) {
              prompt = `You previously created this visualization:\n\n${generatedContent.htmlContent}\n\nThe user wants the following changes:\n${revisionInstructions}\n\nOriginal content for reference:\n${content}\n\nCreate an UPDATED complete HTML visualization incorporating these changes. Respond ONLY with valid HTML code starting with <!DOCTYPE html>.`;
            } else {
              prompt = `You are EconoGraph, a specialist in creating comprehensive data visualizations for economic research.\n\nCRITICAL INSTRUCTIONS:\n1. READ the entire document carefully and extract ALL key data points, statistics, findings, and results\n2. Include ACTUAL NUMBERS from the paper - percentages, amounts, trends, etc.\n3. Create multiple visual sections covering different aspects of the research\n4. Use charts, comparison boxes, timeline visualizations, and statistical displays\n5. Make it comprehensive - don't just summarize, VISUALIZE the actual data\n\nSource Document:\n${content}\n\n${userInstructions ? `SPECIFIC USER INSTRUCTIONS - PRIORITIZE THESE:\n${userInstructions}\n` : 'Create a comprehensive visualization covering all major findings, data points, and conclusions.'}\n\nCreate a complete HTML visualization that:\n- Extracts and displays ACTUAL data from the document (real numbers, percentages, statistics)\n- Includes multiple sections: executive summary, key findings (with numbers), data visualizations, implications\n- Uses visual elements: stat boxes showing actual figures, comparison tables with real data, trend indicators\n- Styled with professional colors: primary green #006847, light green #e8f5f0, clean typography\n- Is comprehensive enough to serve as a standalone brief\n\n${useOfficialBranding ? `Include official branding header:\n- Top border: 4px solid #006847\n- Title: "Economic Insights Brief" (or relevant title from document)\n- Author: ${profile.name}\n- Department: ${profile.department}\n- General Department: ${profile.generalDepartment}\n- Institution: ${profile.institution}\n` : ''}\n\nCRITICAL: Respond ONLY with valid HTML code. Do not include explanations. Start with <!DOCTYPE html>.\nThe HTML must be complete, self-contained, and ready to open in a browser.`;
            }
          } else {
            if (isRevision && generatedContent) {
              prompt = `You previously created this data visualization:\n\n${generatedContent.htmlContent}\n\nThe user wants the following changes:\n${revisionInstructions}\n\nOriginal dataset for reference:\n${content}\n\nCreate an UPDATED complete HTML visualization incorporating these changes. Respond ONLY with valid HTML code starting with <!DOCTYPE html>.`;
            } else {
              prompt = `You are EconoGraph, a specialist in data visualization for economic research.\n\nCRITICAL INSTRUCTIONS:\n1. Analyze the dataset thoroughly and extract ALL data points\n2. Create appropriate visualizations based on the data type (use CSS/HTML for charts where possible)\n3. Include ACTUAL NUMBERS from the dataset\n4. Provide insights and interpretations of the data\n5. Make it comprehensive and professional\n\nDataset:\n${content}\n\n${userInstructions ? `SPECIFIC USER INSTRUCTIONS - PRIORITIZE THESE:\n${userInstructions}\n` : 'Create comprehensive visualizations showing trends, comparisons, and key insights from this data.'}\n\nCreate a complete HTML infographic that:\n- Visualizes the ACTUAL data with real numbers\n- Uses appropriate chart types (bar charts, line graphs using CSS, or data tables)\n- Includes summary statistics, key insights, and data highlights\n- Styled with professional colors: #006847 (primary green), #e8f5f0 (light green)\n- Is professional and publication-ready\n\n${useOfficialBranding ? `Include official branding:\n- Author: ${profile.name}\n- Institution: ${profile.institution}\n- Department: ${profile.department}\n` : ''}\n\nCRITICAL: Respond ONLY with valid HTML code. Start with <!DOCTYPE html>.`;
            }
          }

          const response = await fetch(API_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              prompt: prompt,
              maxTokens: 4096
            })
          });

          const data = await response.json();
          let htmlContent = data.content[0].text;
          htmlContent = htmlContent.replace(/```html\n?/g, '').replace(/```\n?/g, '').trim();
          
          setGeneratedContent({
            type: mode,
            htmlContent: htmlContent,
            originalContent: content,
            branding: useOfficialBranding ? profile : null,
            instructions: userInstructions
          });
          
          setRevisionInstructions('');
          setActiveTab('preview');
        } catch (error) {
          console.error("Error generating visualization:", error);
          alert("Error generating visualization. Please try again.");
        } finally {
          setIsGenerating(false);
        }
      };

      const handleExport = () => {
        if (!generatedContent || !generatedContent.htmlContent) return;
        
        const blob = new Blob([generatedContent.htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `econograph_visualization_${Date.now()}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      return (
        <div className="min-h-screen" style={{ backgroundColor: '#f8f9fa' }}>
          <div className="border-b-4" style={{ borderColor: primaryGreen, backgroundColor: 'white' }}>
            <div className="max-w-6xl mx-auto px-6 py-4">
              <div className="flex justify-between items-center">
                <div className="flex items-center gap-3">
                  <div className="w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold text-xl" style={{ backgroundColor: primaryGreen }}>
                    EG
                  </div>
                  <div>
                    <h1 className="text-xl font-bold" style={{ color: primaryGreen }}>EconoGraph</h1>
                    <p className="text-xs text-gray-600">Economic Research Visualization</p>
                  </div>
                </div>
                <div className="text-right text-sm text-gray-600">
                  <p className="font-semibold">{profile.institution}</p>
                </div>
              </div>
            </div>
          </div>

          <div className="bg-white border-b">
            <div className="max-w-6xl mx-auto px-6">
              <div className="flex gap-1">
                {[
                  { id: 'home', label: 'Home', icon: Sparkles },
                  { id: 'text', label: 'Text Visualization', icon: FileText },
                  { id: 'data', label: 'Data Infographics', icon: Database },
                  { id: 'profile', label: 'Profile', icon: User },
                  { id: 'preview', label: 'Preview', icon: Eye }
                ].map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`flex items-center gap-2 px-6 py-3 font-semibold transition-all ${
                      activeTab === tab.id ? 'border-b-4' : 'opacity-60 hover:opacity-100'
                    }`}
                    style={activeTab === tab.id ? { borderColor: primaryGreen, color: primaryGreen } : {}}
                  >
                    <tab.icon size={18} style={activeTab === tab.id ? { color: primaryGreen } : {}} />
                    {tab.label}
                  </button>
                ))}
              </div>
            </div>
          </div>

          <div className="max-w-6xl mx-auto px-6 py-8">
            {activeTab === 'home' && (
              <div className="space-y-8">
                <div className="text-center mb-12">
                  <h1 className="text-4xl font-bold mb-4" style={{ color: primaryGreen }}>
                    EconoGraph
                  </h1>
                  <p className="text-gray-600 text-lg">
                    Transform Complex Economic Research into Compelling Visuals
                  </p>
                </div>

                <div className="grid md:grid-cols-2 gap-6">
                  <button
                    onClick={() => setActiveTab('text')}
                    className="p-8 border-2 rounded-lg hover:shadow-lg transition-all text-left"
                    style={{ borderColor: primaryGreen }}
                  >
                    <div className="flex items-start gap-4">
                      <FileText size={32} style={{ color: primaryGreen }} />
                      <div>
                        <h3 className="text-xl font-bold mb-2" style={{ color: primaryGreen }}>
                          Text & Ideas Visualization
                        </h3>
                        <p className="text-gray-600">
                          Transform academic papers, reports, or concepts into visual summaries and infographics
                        </p>
                      </div>
                    </div>
                  </button>

                  <button
                    onClick={() => setActiveTab('data')}
                    className="p-8 border-2 rounded-lg hover:shadow-lg transition-all text-left"
                    style={{ borderColor: primaryGreen }}
                  >
                    <div className="flex items-start gap-4">
                      <Database size={32} style={{ color: primaryGreen }} />
                      <div>
                        <h3 className="text-xl font-bold mb-2" style={{ color: primaryGreen }}>
                          Data-Driven Infographics
                        </h3>
                        <p className="text-gray-600">
                          Upload or paste datasets to create insightful charts, graphs, and visualizations
                        </p>
                      </div>
                    </div>
                  </button>
                </div>

                <div className="mt-12 p-6 rounded-lg" style={{ backgroundColor: lightGreen }}>
                  <div className="flex items-start gap-4">
                    <Sparkles style={{ color: primaryGreen }} size={24} />
                    <div>
                      <h4 className="font-bold mb-2" style={{ color: primaryGreen }}>
                        How to Get Great Results
                      </h4>
                      <ul className="text-gray-700 space-y-2 text-sm">
                        <li><strong>1. Upload or paste</strong> your complete research paper or dataset</li>
                        <li><strong>2. Be specific</strong> in the instructions field</li>
                        <li><strong>3. Enable "Apply Branding"</strong> to include your institutional information</li>
                        <li><strong>4. Review and refine</strong> using the adjustment feature</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'text' && (
              <div className="space-y-6">
                <div className="flex items-center gap-3 mb-6">
                  <FileText size={28} style={{ color: primaryGreen }} />
                  <h2 className="text-2xl font-bold" style={{ color: primaryGreen }}>
                    Text & Ideas Visualization
                  </h2>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block font-semibold mb-2" style={{ color: primaryGreen }}>
                      Upload Paper or Paste Text
                    </label>
                    
                    <div className="mb-4 p-4 border-2 border-dashed rounded-lg text-center" style={{ borderColor: primaryGreen }}>
                      <Upload size={32} className="mx-auto mb-2" style={{ color: primaryGreen }} />
                      <p className="text-gray-600 mb-2">Upload PDF or Text file</p>
                      <input
                        type="file"
                        accept=".pdf,.txt"
                        className="hidden"
                        id="text-file-upload"
                        onChange={(e) => handleFileUpload(e, 'text')}
                        disabled={isProcessingFile}
                      />
                      <label
                        htmlFor="text-file-upload"
                        className={`inline-block px-6 py-2 rounded-lg cursor-pointer text-white font-semibold ${isProcessingFile ? 'opacity-50' : ''}`}
                        style={{ backgroundColor: primaryGreen }}
                      >
                        {isProcessingFile ? 'Extracting text...' : 'Choose File'}
                      </label>
                      {uploadedFileName && (
                        <p className="text-sm mt-2 text-gray-600">‚úì Uploaded: {uploadedFileName}</p>
                      )}
                    </div>

                    <p className="text-center text-gray-500 text-sm mb-3">OR</p>

                    <textarea
                      value={textInput}
                      onChange={(e) => setTextInput(e.target.value)}
                      className="w-full h-64 p-4 border-2 rounded-lg focus:outline-none focus:ring-2"
                      style={{ borderColor: primaryGreen }}
                      placeholder="Paste your academic paper, report summary, or describe the concept you want to visualize..."
                    />
                  </div>

                  <div>
                    <label className="block font-semibold mb-2" style={{ color: primaryGreen }}>
                      What should the visualization focus on? (Optional but Recommended)
                    </label>
                    <textarea
                      value={userInstructions}
                      onChange={(e) => setUserInstructions(e.target.value)}
                      className="w-full h-32 p-4 border-2 rounded-lg focus:outline-none focus:ring-2"
                      style={{ borderColor: primaryGreen }}
                      placeholder="Examples:&#10;‚Ä¢ Focus on the comparison between the two competing narratives&#10;‚Ä¢ Highlight all the statistical data and create charts for key metrics&#10;‚Ä¢ Build a narrative around the three future scenarios"
                    />
                    <p className="text-sm text-gray-600 mt-2">
                      üí° The more specific you are, the better the visualization will match your needs
                    </p>
                  </div>

                  <div>
                    <label className="flex items-center gap-3 cursor-pointer p-3 border-2 rounded-lg w-full" style={{ borderColor: primaryGreen }}>
                      <input
                        type="checkbox"
                        checked={useOfficialBranding}
                        onChange={(e) => setUseOfficialBranding(e.target.checked)}
                        className="w-5 h-5"
                      />
                      <span className="font-semibold" style={{ color: primaryGreen }}>
                        Apply Institutional Branding
                      </span>
                    </label>
                  </div>

                  <button
                    onClick={() => handleGenerateVisualization(false)}
                    disabled={!textInput || isGenerating}
                    className="w-full py-4 text-white font-bold rounded-lg hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    style={{ backgroundColor: primaryGreen }}
                  >
                    {isGenerating ? (
                      <>
                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                        Analyzing content and creating visualization...
                      </>
                    ) : (
                      <>
                        <Sparkles size={20} />
                        Generate Comprehensive Visualization
                      </>
                    )}
                  </button>
                </div>
              </div>
            )}

            {activeTab === 'data' && (
              <div className="space-y-6">
                <div className="flex items-center gap-3 mb-6">
                  <Database size={28} style={{ color: primaryGreen }} />
                  <h2 className="text-2xl font-bold" style={{ color: primaryGreen }}>
                    Data-Driven Infographics
                  </h2>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block font-semibold mb-2" style={{ color: primaryGreen }}>
                      Upload Data File or Paste Data
                    </label>
                    
                    <div className="p-4 border-2 border-dashed rounded-lg text-center mb-4" style={{ borderColor: primaryGreen }}>
                      <Upload size={32} className="mx-auto mb-2" style={{ color: primaryGreen }} />
                      <p className="text-gray-600 mb-2">Upload CSV file</p>
                      <input
                        type="file"
                        accept=".csv,.txt"
                        className="hidden"
                        id="data-file-upload"
                        onChange={(e) => handleFileUpload(e, 'data')}
                        disabled={isProcessingFile}
                      />
                      <label
                        htmlFor="data-file-upload"
                        className={`inline-block px-6 py-2 rounded-lg cursor-pointer text-white font-semibold ${isProcessingFile ? 'opacity-50' : ''}`}
                        style={{ backgroundColor: primaryGreen }}
                      >
                        {isProcessingFile ? 'Processing...' : 'Choose File'}
                      </label>
                      {uploadedFileName && (
                        <p className="text-sm mt-2 text-gray-600">‚úì Uploaded: {uploadedFileName}</p>
                      )}
                    </div>

                    <p className="text-center text-gray-500 text-sm mb-3">OR</p>

                    <textarea
                      value={dataInput}
                      onChange={(e) => setDataInput(e.target.value)}
                      className="w-full h-48 p-4 border-2 rounded-lg focus:outline-none focus:ring-2"
                      style={{ borderColor: primaryGreen }}
                      placeholder="Paste CSV data or describe your dataset here..."
                    />
                  </div>

                  <div>
                    <label className="block font-semibold mb-2" style={{ color: primaryGreen }}>
                      Describe Your Goal / What to Focus On
                    </label>
                    <textarea
                      value={userInstructions}
                      onChange={(e) => setUserInstructions(e.target.value)}
                      className="w-full h-32 p-4 border-2 rounded-lg focus:outline-none focus:ring-2"
                      style={{ borderColor: primaryGreen }}
                      placeholder="Examples:&#10;‚Ä¢ Show trends over time with year-over-year comparisons&#10;‚Ä¢ Create comparison charts showing performance vs benchmarks&#10;‚Ä¢ Focus on quarterly trends and seasonal patterns"
                    />
                  </div>

                  <div>
                    <label className="flex items-center gap-3 cursor-pointer p-3 border-2 rounded-lg w-full" style={{ borderColor: primaryGreen }}>
                      <input
                        type="checkbox"
                        checked={useOfficialBranding}
                        onChange={(e) => setUseOfficialBranding(e.target.checked)}
                        className="w-5 h-5"
                      />
                      <span className="font-semibold" style={{ color: primaryGreen }}>
                        Apply Institutional Branding
                      </span>
                    </label>
                  </div>

                  <button
                    onClick={() => handleGenerateVisualization(false)}
                    disabled={!dataInput || isGenerating}
                    className="w-full py-4 text-white font-bold rounded-lg hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    style={{ backgroundColor: primaryGreen }}
                  >
                    {isGenerating ? (
                      <>
                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                        Analyzing data and creating infographic...
                      </>
                    ) : (
                      <>
                        <Sparkles size={20} />
                        Generate Comprehensive Infographic
                      </>
                    )}
                  </button>
                </div>
              </div>
            )}

            {activeTab === 'profile' && (
              <div className="space-y-6">
                <div className="flex items-center gap-3 mb-6">
                  <User size={28} style={{ color: primaryGreen }} />
                  <h2 className="text-2xl font-bold" style={{ color: primaryGreen }}>
                    Profile & Branding Settings
                  </h2>
                </div>

                <div className="p-6 rounded-lg" style={{ backgroundColor: lightGreen }}>
                  <p className="text-gray-700 mb-4">
                    Save your institutional information here. When you enable "Apply Institutional Branding," your visualizations will automatically include this information.
                  </p>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block font-semibold mb-2" style={{ color: primaryGreen }}>Your Name</label>
                    <input
                      type="text"
                      value={profile.name}
                      onChange={(e) => setProfile({ ...profile, name: e.target.value })}
                      className="w-full p-3 border-2 rounded-lg"
                      style={{ borderColor: primaryGreen }}
                    />
                  </div>
                  <div>
                    <label className="block font-semibold mb-2" style={{ color: primaryGreen }}>Department</label>
                    <input
                      type="text"
                      value={profile.department}
                      onChange={(e) => setProfile({ ...profile, department: e.target.value })}
                      className="w-full p-3 border-2 rounded-lg"
                      style={{ borderColor: primaryGreen }}
                    />
                  </div>
                  <div>
                    <label className="block font-semibold mb-2" style={{ color: primaryGreen }}>General Department</label>
                    <input
                      type="text"
                      value={profile.generalDepartment}
                      onChange={(e) => setProfile({ ...profile, generalDepartment: e.target.value })}
                      className="w-full p-3 border-2 rounded-lg"
                      style={{ borderColor: primaryGreen }}
                    />
                  </div>
                  <div>
                    <label className="block font-semibold mb-2" style={{ color: primaryGreen }}>Institution</label>
                    <input
                      type="text"
                      value={profile.institution}
                      onChange={(e) => setProfile({ ...profile, institution: e.target.value })}
                      className="w-full p-3 border-2 rounded-lg"
                      style={{ borderColor: primaryGreen }}
                    />
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'preview' && (
              <div className="space-y-6">
                <div className="flex items-center gap-3 mb-6">
                  <Eye size={28} style={{ color: primaryGreen }} />
                  <h2 className="text-2xl font-bold" style={{ color: primaryGreen }}>
                    Visualization Preview
                  </h2>
                </div>

                {generatedContent ? (
                  <div className="space-y-6">
                    {generatedContent.branding && (
                      <div className="p-4 rounded-lg border-2" style={{ borderColor: primaryGreen, backgroundColor: lightGreen }}>
                        <h3 className="font-bold mb-2 text-sm" style={{ color: primaryGreen }}>‚úì Institutional Branding Applied</h3>
                        <p className="text-xs text-gray-700">
                          {generatedContent.branding.name} ‚Ä¢ {generatedContent.branding.institution}
                        </p>
                      </div>
                    )}

                    <div className="bg-white border-2 rounded-lg overflow-hidden" style={{ borderColor: primaryGreen }}>
                      <div className="p-3 border-b-2 flex justify-between items-center" style={{ borderColor: primaryGreen, backgroundColor: lightGreen }}>
                        <h3 className="font-bold" style={{ color: primaryGreen }}>Live Preview</h3>
                        <span className="text-xs text-gray-600">Scroll to view full visualization</span>
                      </div>
                      <div className="overflow-auto" style={{ maxHeight: '600px' }}>
                        <iframe
                          srcDoc={generatedContent.htmlContent}
                          className="w-full border-0"
                          style={{ minHeight: '500px', height: '100%' }}
                          title="Visualization Preview"
                        />
                      </div>
                    </div>

                    <div className="flex gap-4">
                      <button
                        className="flex-1 py-3 px-6 border-2 rounded-lg font-semibold hover:opacity-80 transition-all flex items-center justify-center gap-2"
                        style={{ borderColor: primaryGreen, color: primaryGreen }}
                        onClick={() => setActiveTab(generatedContent.type)}
                      >
                        ‚Üê Edit Input
                      </button>
                      <button
                        onClick={handleExport}
                        className="flex-1 py-3 px-6 text-white font-bold rounded-lg hover:opacity-90 transition-all flex items-center justify-center gap-2"
                        style={{ backgroundColor: primaryGreen }}
                      >
                        <Download size={20} />
                        Download HTML
                      </button>
                    </div>

                    <div className="p-6 rounded-lg border-2" style={{ borderColor: primaryGreen }}>
                      <h3 className="font-bold mb-3" style={{ color: primaryGreen }}>Make Adjustments</h3>
                      <p className="text-sm text-gray-600 mb-3">
                        Not quite right? Describe what you'd like to change and regenerate.
                      </p>
                      <textarea
                        value={revisionInstructions}
                        onChange={(e) => setRevisionInstructions(e.target.value)}
                        className="w-full h-32 p-4 border-2 rounded-lg mb-3"
                        style={{ borderColor: primaryGreen }}
                        placeholder="Examples:&#10;‚Ä¢ Add more emphasis on the data from section 3&#10;‚Ä¢ Make the font sizes larger for better readability&#10;‚Ä¢ Add a timeline visualization"
                      />
                      <button
                        onClick={() => handleGenerateVisualization(true)}
                        disabled={!revisionInstructions || isGenerating}
                        className="w-full py-3 text-white font-bold rounded-lg hover:opacity-90 transition-all disabled:opacity-50 flex items-center justify-center gap-2"
                        style={{ backgroundColor: primaryGreen }}
                      >
                        {isGenerating ? (
                          <>
                            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                            Regenerating...
                          </>
                        ) : (
                          <>
                            <Sparkles size={20} />
                            Regenerate with Changes
                          </>
                        )}
                      </button>
                    </div>

                    <div className="p-4 rounded-lg" style={{ backgroundColor: lightGreen }}>
                      <p className="text-sm text-gray-700">
                        <strong>How to convert to other formats:</strong>
                      </p>
                      <ul className="text-sm text-gray-700 mt-2 space-y-1 ml-4">
                        <li><strong>‚Üí PDF:</strong> Open HTML file, then Print (Ctrl/Cmd + P) and "Save as PDF"</li>
                        <li><strong>‚Üí PNG/JPEG:</strong> Take a screenshot or use browser extensions</li>
                      </ul>
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-12 text-gray-500">
                    <Eye size={48} className="mx-auto mb-4 opacity-30" />
                    <p>No visualization generated yet. Create one from the Text or Data tabs.</p>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<EconoGraph />);
  </script>
</body>
</html>
